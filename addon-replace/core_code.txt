<<widget "schoolday">>
<<if $rent_acc_mode is "t">> 	<!--功能啟用，於設置選單中啟用-->	
	<<if $renttime lte -7 and $run_one_per_week is undefined>>		<!--功能初始化，當遲交7天時觸發-->	
		<<set $run_one_per_day to Time.days >>	<!--每天只執行一次，計數器初始化-->
		<<set $run_one_per_week to (Time.days - ($renttime%7)) >>	<!--每七天累加一次遲繳租金，計數器初始化，計算當前拖欠租金為X週又Y天(%7=取餘數)，下一次累加日為當天(Time.days)+Y-->					
		<<if - ($renttime%7) is 0>>
			<<set $run_one_per_week += 7>>
			<<set $run_one_per_week_TEST to "pass" >>
		<</if>> 	
		<<set $rent_delay to -(Math.ceil($renttime/7))  >>	<!--計算幾周沒繳租金-->
		<<set $rentmoney_current to $rentmoney  >>		 <!--獲取當前每周租金-->	 
		<<set $rentmoney_accumulation to $rentmoney >> <!--獲取當前每周租金(後續用於累加計算-->	 
		<<set $rentmoney to $rentmoney_current + $rentmoney_accumulation * $rent_delay >>	<!--執行計算，公式：當前租金+每周應繳租金*遲交週數 -->	
	<<elseif $run_one_per_day isnot Time.days and $run_one_per_week isnot Time.days>>	<!--尚未到達下一次累加日-->
		<<set $rent_delay to -(Math.ceil($renttime/7))  >>	<!--計算幾周沒繳租金-->
		<<set $run_one_per_day to Time.days >>	<!--每天只執行一次，計數器更新-->
	<<elseif $run_one_per_day isnot Time.days and $run_one_per_week is Time.days>>	<!--到達累加日-->
		<<set $rent_delay to -(Math.ceil($renttime/7))  >>	<!--計算幾周沒繳租金-->
		<<set $rentmoney to $rentmoney_current + $rentmoney_accumulation * $rent_delay >>	<!--執行計算，公式：當前租金+每周應繳租金*遲交週數 -->		
		<<set $run_one_per_week to Time.days + 7 >>				<!--更新下一次累加日-->		
		<<set $run_one_per_day to Time.days >>	<!--每天只執行一次，計數器更新-->	
	<<elseif $renttime lt 0 and $renttime gt -7>>	<!--用於日誌顯示：躲債不滿一週-->
		<<set $rentmoney_current to $rentmoney  >>		 
		<<set $rentmoney_accumulation to $rentmoney >>
		<<set $rent_delay to -(Math.ceil($renttime/7))  >>	
	<<elseif $renttime is 7 >> 	<!--如果已經交租金(或被貝利賣掉)則重置-->
		<<unset $run_one_per_week >>
		<<unset $run_one_per_day >>
		<<unset $rent_delay >>
		<<unset $rentmoney_current >>
		<<unset $rentmoney_accumulation >>
		<<unset $renttime_delay >>
		<<unset $renttime_delay_money >>
	<</if>>		
<<elseif $rent_acc_mode is "f">> 	<!--如果中途關閉則在交租金後重置-->
	<<if $renttime gte 0 and $run_one_per_week isnot undefined>> 
		<<unset $run_one_per_week >>
		<<unset $run_one_per_day >>
		<<unset $rent_delay >>
		<<unset $rentmoney_current >>
		<<unset $rentmoney_accumulation >>
		<<unset $renttime_delay >>
		<<unset $renttime_delay_money >>
	<</if>>	
<</if>>